# Clash.Meta 配置文件 (安全版)
# 移除了所有 Emoji 符号以增强客户端兼容性
# 最后更新: 2024-06-27

# 端口设置
mixed-port: 7890
allow-lan: true
mode: rule # rule/global/direct
log-level: info
ipv6: false

# DNS 配置
dns:
  enable: true
  listen: 0.0.0.0:1053
  prefer-h3: false
  respect-rules: true
  use-system-hosts: false
  cache-algorithm: arc
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - '+.lan'
    - '+.local'
    - '+.msftconnecttest.com'
    - '+.msftncsi.com'
    - 'localhost.ptlogin2.qq.com'
    - 'localhost.sec.qq.com'
    - 'localhost.work.weixin.qq.com'
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  nameserver:
    - https://cloudflare-dns.com/dns-query
    - https://dns.google/dns-query
  proxy-server-nameserver:
    - https://cloudflare-dns.com/dns-query
  direct-nameserver:
    - https://223.5.5.5/dns-query
    - https://doh.pub/dns-query
  nameserver-policy:
    'geosite:cn':
      - https://223.5.5.5/dns-query

# 代理节点 (手动管理)
# -----------------------------------------------
proxies:
  - name: 'Landing-Socks5-Example'
    server: 1.2.3.4 # 替换成你的落地节点 IP 或域名
    port: 1080
    type: socks5
    username: 'your-user' # 替换成你的用户名
    password: 'your-password' # 替换成你的密码
    udp: true
    dialer-proxy: 'Nodes-Select' # 关键：指定前置代理组

  - name: 'Landing-SS-Example'
    server: 5.6.7.8
    port: 20742
    type: ss
    cipher: chacha20-ietf-poly1305
    password: 'your-password'
    udp: true
    dialer-proxy: 'Nodes-Select' # 关键：指定前置代理组

# 代理订阅管理 (Proxy Providers)
# -----------------------------------------------
proxy-providers:
  Provider-1: # 您可以重命名为 'LiuLiangGuang' 等
    type: http
    # 替换成您的订阅链接
    url: "https://your-subscription-url.com/api/v1/client/subscribe?token=your-token"
    interval: 86400
    path: ./providers/Provider-1.yaml
    health-check:
      enable: true
      url: https://www.google.com/generate_204
      interval: 300
    override:
      additional-prefix: "P1 | "

  Provider-2: # 您可以重命名为 'Green' 等
    type: http
    # 替换成您的订阅链接
    url: "http://your-subscription-url.com/your-path"
    interval: 86400
    path: ./providers/Provider-2.yaml
    health-check:
      enable: true
      url: https://www.google.com/generate_204
      interval: 300
    override:
      additional-prefix: "P2 | "

# 代理组 (策略组)
# -----------------------------------------------
proxy-groups:
  - name: 'Mode-Select'
    type: select
    proxies:
      - 'Nodes-Select'
      - 'Landing-Nodes'
      - 'Global-Direct'

  - name: 'Nodes-Select'
    type: select
    proxies:
      - 'URL-Test'
      - 'Fallback'
      - 'Load-Balance'
    use:
      - Provider-1
      - Provider-2
    exclude-filter: '^(Landing-Socks5-Example|Landing-SS-Example)$'

  - name: 'Landing-Nodes'
    type: select
    proxies:
      - 'Landing-Socks5-Example'
      - 'Landing-SS-Example'

  - name: 'URL-Test'
    type: url-test
    url: 'https://www.google.com/generate_204'
    interval: 300
    tolerance: 50
    use:
      - Provider-1
      - Provider-2
    exclude-filter: '^(Landing-Socks5-Example|Landing-SS-Example)$'

  - name: 'Fallback'
    type: fallback
    url: 'https://www.google.com/generate_204'
    interval: 300
    use:
      - Provider-1
      - Provider-2
    exclude-filter: '^(Landing-Socks5-Example|Landing-SS-Example)$'

  - name: 'Load-Balance'
    type: load-balance
    strategy: consistent-hashing
    url: 'https://www.google.com/generate_204'
    interval: 300
    use:
      - Provider-1
      - Provider-2
    exclude-filter: '^(Landing-Socks5-Example|Landing-SS-Example)$'

  # --- 其他功能性策略组 ---
  - { name: 'AI-Services', type: select, proxies: ['Mode-Select', 'Nodes-Select', 'Landing-Nodes'], use: ['Provider-1', 'Provider-2'], exclude-filter: '(?i)港|hk|hongkong|hong kong|俄|ru|russia|澳|macao' }
  - { name: 'Telegram', type: select, proxies: ['Mode-Select', 'Nodes-Select', 'Landing-Nodes'], use: ['Provider-1', 'Provider-2'] }
  - { name: 'Google-Services', type: select, proxies: ['Mode-Select', 'Nodes-Select'], use: ['Provider-1', 'Provider-2'] }
  - { name: 'Apple-Services', type: select, proxies: ['Mode-Select', 'Global-Direct'], use: ['Provider-1', 'Provider-2'] }
  - { name: 'Microsoft-Services', type: select, proxies: ['Mode-Select', 'Global-Direct'], use: ['Provider-1', 'Provider-2'] }
  - { name: 'Ad-Block', type: select, proxies: ['REJECT', 'DIRECT'] }
  - { name: 'Global-Direct', type: select, proxies: ['DIRECT'] }
  - { name: 'Custom-Direct', type: select, proxies: ['DIRECT', 'Mode-Select'], use: ['Provider-1', 'Provider-2'] }
  - { name: 'Custom-Proxy', type: select, proxies: ['Mode-Select', 'Nodes-Select'], use: ['Provider-1', 'Provider-2'] }
  - { name: 'Final-Match', type: select, proxies: ['Mode-Select', 'Nodes-Select', 'Landing-Nodes'], use: ['Provider-1', 'Provider-2'] }

# 规则集 (Rule Providers)
# -----------------------------------------------
rule-providers:
  reject: { type: http, behavior: domain, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt", path: ./ruleset/reject.yaml, interval: 86400 }
  icloud: { type: http, behavior: domain, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/icloud.txt", path: ./ruleset/icloud.yaml, interval: 86400 }
  apple: { type: http, behavior: domain, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/apple.txt", path: ./ruleset/apple.yaml, interval: 86400 }
  google: { type: http, behavior: domain, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/google.txt", path: ./ruleset/google.yaml, interval: 86400 }
  proxy: { type: http, behavior: domain, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt", path: ./ruleset/proxy.yaml, interval: 86400 }
  direct: { type: http, behavior: domain, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt", path: ./ruleset/direct.yaml, interval: 86400 }
  private: { type: http, behavior: domain, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt", path: ./ruleset/private.yaml, interval: 86400 }
  gfw: { type: http, behavior: domain, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/gfw.txt", path: ./ruleset/gfw.yaml, interval: 86400 }
  tld-not-cn: { type: http, behavior: domain, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/tld-not-cn.txt", path: ./ruleset/tld-not-cn.yaml, interval: 86400 }
  telegramcidr: { type: http, behavior: ipcidr, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/telegramcidr.txt", path: ./ruleset/telegramcidr.yaml, interval: 86400 }
  cncidr: { type: http, behavior: ipcidr, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt", path: ./ruleset/cncidr.yaml, interval: 86400 }
  lancidr: { type: http, behavior: ipcidr, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt", path: ./ruleset/lancidr.yaml, interval: 86400 }
  applications: { type: http, behavior: classical, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt", path: ./ruleset/applications.yaml, interval: 86400 }
  openai: { type: http, behavior: classical, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/openai.yml", path: ./ruleset/openai.yaml, interval: 86400 }
  microsoft: { type: http, behavior: classical, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/meta/geo/geosite/microsoft.yml", path: ./ruleset/microsoft.yaml, interval: 86400 }

# 路由规则 (Rules)
# -----------------------------------------------
rules:
  # --- 自定义规则 ---
  - PROCESS-NAME,steam.exe,Custom-Direct
  - DOMAIN-SUFFIX,immersivetranslate.com,Custom-Proxy
  # --- 规则集 ---
  - RULE-SET,applications,Global-Direct
  - RULE-SET,private,Global-Direct
  - RULE-SET,reject,Ad-Block
  - RULE-SET,microsoft,Microsoft-Services
  - RULE-SET,icloud,Apple-Services
  - RULE-SET,apple,Apple-Services
  - RULE-SET,google,Google-Services
  - RULE-SET,openai,AI-Services
  - RULE-SET,proxy,Mode-Select
  - RULE-SET,gfw,Mode-Select
  - RULE-SET,tld-not-cn,Mode-Select
  - RULE-SET,direct,Global-Direct
  - RULE-SET,lancidr,Global-Direct,no-resolve
  - RULE-SET,cncidr,Global-Direct,no-resolve
  - RULE-SET,telegramcidr,Telegram,no-resolve
  # --- GEOIP规则 ---
  - GEOIP,LAN,Global-Direct,no-resolve
  - GEOIP,CN,Global-Direct,no-resolve
  # --- 兜底规则 ---
  - MATCH,Final-Match

