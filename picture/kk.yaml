#----------------------------------------------------------------#
#                                                                #
#          Clash.Meta é™æ€é…ç½®æ–‡ä»¶ - è¿ç§»è‡ªæ‰©å±•è„šæœ¬          #
#                                                                #
#----------------------------------------------------------------#

# --- åŸºç¡€é…ç½®å‚æ•° (Section 2) ---
# å®šä¹‰ Clash æ ¸å¿ƒçš„ç›‘å¬ç«¯å£ã€API å’Œå…¨å±€è¡Œä¸º

# æ··åˆç«¯å£ï¼ŒåŒæ—¶æ”¯æŒ HTTP å’Œ SOCKS5 åè®®ï¼Œç®€åŒ–å®¢æˆ·ç«¯é…ç½®
mixed-port: 7890

# å…è®¸æ¥è‡ªå±€åŸŸç½‘çš„è¿æ¥ï¼Œå¿…é¡»è®¾ç½®ä¸º true æ‰èƒ½è®©å…¶ä»–è®¾å¤‡ä½¿ç”¨æ­¤ Clash å®ä¾‹ä½œä¸ºç½‘å…³
allow-lan: true

# ç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ï¼Œé…åˆ allow-lan: true ä½¿ç”¨
bind-address: '*'

# RESTful API ç›‘å¬åœ°å€ï¼Œè®¾ç½®ä¸º 0.0.0.0:9090 ä»¥å…è®¸å±€åŸŸç½‘å†…çš„ Web UI è®¿é—®
external-controller: '0.0.0.0:9090'

# (å¯é€‰) API è®¿é—®å¯†é’¥ï¼Œå¢å¼ºå®‰å…¨æ€§
# secret: 'YourSecretKey'

# Web UI (Dashboard) çš„è·¯å¾„ï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹
external-ui: './dashboard'

# è¿è¡Œæ¨¡å¼ï¼Œå¿…é¡»ä¸º 'rule' ä»¥å¯ç”¨è§„åˆ™åˆ†æµ
mode: rule

# æ—¥å¿—çº§åˆ«ï¼Œ'info' æä¾›äº†è¶³å¤Ÿçš„ä¿¡æ¯ç”¨äºæ—¥å¸¸ç›‘æ§ï¼Œ'debug' ç”¨äºæ·±åº¦æ’æŸ¥
log-level: info

# æ˜¯å¦å¯ç”¨ IPv6ï¼Œæ ¹æ®æ‚¨çš„ç½‘ç»œç¯å¢ƒå†³å®š
ipv6: false

# --- DNS é…ç½® (Section 6) ---
# æ„å»ºä¸€ä¸ªé«˜æ•ˆã€æŠ—æ±¡æŸ“çš„ DNS è§£æç³»ç»Ÿ

dns:
  enable: true
  # ç›‘å¬åœ°å€ï¼Œä½œä¸ºå±€åŸŸç½‘çš„ DNS æœåŠ¡å™¨
  listen: 0.0.0.0:53
  # å¢å¼ºæ¨¡å¼ï¼Œ'fake-ip' æ˜¯å®ç° TUN æ¨¡å¼ä¸‹åŸŸååˆ†æµçš„åŸºçŸ³
  enhanced-mode: fake-ip
  # Fake IP åœ°å€æ± çš„èŒƒå›´
  fake-ip-range: 198.18.0.1/16
  # ä¼˜å…ˆä½¿ç”¨ç³»ç»Ÿ hosts æ–‡ä»¶
  use-hosts: true
  # å›½å†… DNS æœåŠ¡å™¨ï¼Œç”¨äºå¿«é€Ÿè§£æå›½å†…åŸŸå
  nameserver:
    - 223.5.5.5
    - 119.29.29.29
  # å¤‡ç”¨ DNSï¼Œä½¿ç”¨åŠ å¯†çš„å›½å¤– DNS (DoH/DoT) æ¥é˜²æ­¢æ±¡æŸ“
  fallback:
    - https://dns.google/dns-query
    - tls://1.1.1.1:853
  # å¤‡ç”¨ DNS è¿‡æ»¤å™¨ï¼Œå½“ nameserver è§£æå‡ºéä¸­å›½å¤§é™† IP æ—¶ï¼Œä½¿ç”¨ fallback çš„ç»“æœ
  fallback-filter:
    geoip: true
    geoip-code: CN

# --- TUN æ¨¡å¼é…ç½® (Section 6) ---
# æ¥ç®¡ç³»ç»Ÿæ‰€æœ‰ç½‘ç»œæµé‡ï¼Œå®ç°çœŸÂ·å…¨å±€ä»£ç†

tun:
  enable: true
  # ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„ç½‘ç»œåè®®æ ˆï¼Œæ€§èƒ½æœ€é«˜
  stack: system
  # è‡ªåŠ¨é…ç½®ç³»ç»Ÿè·¯ç”±è¡¨
  auto-route: true
  # è‡ªåŠ¨æ£€æµ‹ä¸»ç½‘ç»œæ¥å£
  auto-detect-interface: true
  # DNS åŠ«æŒï¼ŒTUN æ¨¡å¼çš„å‘½è„‰ï¼Œç¡®ä¿æ‰€æœ‰ DNS è¯·æ±‚éƒ½è¢« Clash å¤„ç†
  dns-hijack:
    - 'any:53'

# --- ä»£ç†è®¢é˜…æº (Section 3) ---
# å®šä¹‰æ‰€æœ‰çš„è¿œç¨‹ä»£ç†è®¢é˜…é“¾æ¥

proxy-providers:
  # ç¤ºä¾‹è®¢é˜…æº 1
  MyProvider1:
    type: http
    url: "https://your-subscription-url-1.com/sub"
    # æ¯å°æ—¶æ›´æ–°ä¸€æ¬¡
    interval: 3600
    path:./providers/provider1.yaml
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 600
  # ç¤ºä¾‹è®¢é˜…æº 2
  MyProvider2:
    type: http
    url: "https://your-subscription-url-2.com/sub"
    interval: 3600
    path:./providers/provider2.yaml
    health-check:
      enable: true
      url: http://www.gstatic.com/generate_204
      interval: 600

# --- ä»£ç†ç»„ (Section 4) ---
# ç»„ç»‡ä»£ç†èŠ‚ç‚¹ï¼Œå®šä¹‰ç­–ç•¥è¡Œä¸º

proxy-groups:
  # --- é¡¶å±‚æ‰‹åŠ¨é€‰æ‹©ç»„ ---
  - name: 'PROXY'
    type: select
    proxies:
      - 'ğŸ”° è‡ªåŠ¨é€‰æ‹©'
      - ' DIRECT'
      - 'REJECT'
      - 'ğŸŒ å›½å¤–æµé‡'
      - 'ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹'
      - 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹'
      - 'ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹'

  # --- è‡ªåŠ¨ç­–ç•¥ç»„ ---
  - name: 'ğŸ”° è‡ªåŠ¨é€‰æ‹©'
    type: url-test
    # å¼•å…¥æ‰€æœ‰è®¢é˜…æº
    use:
      - MyProvider1
      - MyProvider2
    url: 'http://www.gstatic.com/generate_204'
    interval: 300
    # å»¶è¿Ÿå®¹å¿å€¼ï¼Œé˜²æ­¢é¢‘ç¹åˆ‡æ¢
    tolerance: 50

  - name: 'ğŸŒ å›½å¤–æµé‡'
    type: url-test
    use:
      - MyProvider1
      - MyProvider2
    # æ’é™¤å›½å†…èŠ‚ç‚¹
    exclude-filter: 'CN|ä¸­å›½|å†…|ä¸“çº¿'
    url: 'http://www.gstatic.com/generate_204'
    interval: 300
    tolerance: 50

  # --- æŒ‰åŒºåŸŸç­›é€‰çš„ç­–ç•¥ç»„ ---
  - name: 'ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹'
    type: url-test
    use:
      - MyProvider1
      - MyProvider2
    # ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ç­›é€‰é¦™æ¸¯èŠ‚ç‚¹
    filter: 'HK|Hong Kong|é¦™æ¸¯'
    url: 'http://www.gstatic.com/generate_204'
    interval: 300
    tolerance: 50

  - name: 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹'
    type: url-test
    use:
      - MyProvider1
      - MyProvider2
    filter: 'JP|Japan|æ—¥æœ¬'
    url: 'http://www.gstatic.com/generate_204'
    interval: 300
    tolerance: 50

  - name: 'ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹'
    type: url-test
    use:
      - MyProvider1
      - MyProvider2
    filter: 'US|United States|ç¾å›½'
    url: 'http://www.gstatic.com/generate_204'
    interval: 300
    tolerance: 50

  # --- ç‰¹å®šæœåŠ¡ç­–ç•¥ç»„ ---
  - name: 'ğŸ“º Netflix'
    type: select
    proxies:
      - 'ğŸ‡­ğŸ‡° é¦™æ¸¯èŠ‚ç‚¹'
      - 'ğŸ‡¯ğŸ‡µ æ—¥æœ¬èŠ‚ç‚¹'
      - 'ğŸ‡ºğŸ‡¸ ç¾å›½èŠ‚ç‚¹'
      - 'PROXY'

  - name: 'ğŸµ YouTube'
    type: select
    proxies:
      - 'ğŸ”° è‡ªåŠ¨é€‰æ‹©'
      - 'PROXY'

# --- è§„åˆ™é›† (Section 5) ---
# å®šä¹‰æµé‡åˆ†æµè§„åˆ™ï¼Œé¡ºåºè‡³å…³é‡è¦

rules:
  # --- ç›´è¿è§„åˆ™ ---
  # å±€åŸŸç½‘åœ°å€
  - GEOIP, LAN, DIRECT
  # ä¸­å›½å¤§é™† IP
  - GEOIP, CN, DIRECT
  # ä¸­å›½å¤§é™†åŸŸå
  - GEOSITE, CN, DIRECT
  # å¸¸è§éœ€è¦ç›´è¿çš„æœåŠ¡
  - GEOSITE, Private, DIRECT
  - GEOSITE, Apple-CN, DIRECT
  - GEOSITE, Microsoft-CN, DIRECT

  # --- ä»£ç†è§„åˆ™ ---
  # ç‰¹å®šæœåŠ¡èµ°ç‰¹å®šç­–ç•¥
  - GEOSITE, Netflix, 'ğŸ“º Netflix'
  - GEOSITE, Youtube, 'ğŸµ YouTube'
  # Telegram IP èµ°ä»£ç†ï¼Œæ— éœ€è§£æåŸŸåï¼Œæé«˜é€Ÿåº¦å’ŒæŠ—æ±¡æŸ“
  - GEOIP, Telegram, PROXY, no-resolve
  # å›½å¤–çŸ¥åç½‘ç«™
  - GEOSITE, Google, PROXY
  - GEOSITE, Facebook, PROXY
  - GEOSITE, Twitter, PROXY

  # --- æœ€ç»ˆè§„åˆ™ ---
  # æœªè¢«åŒ¹é…çš„éä¸­å›½å¤§é™†æµé‡èµ°ä»£ç†
  - GEOSITE, Geolocation-!CN, PROXY
  # æ‰€æœ‰å…¶ä»–æœªåŒ¹é…çš„æµé‡èµ°æ€»ä»£ç†å…¥å£
  - MATCH, PROXY
