# Clash.Meta Configuration File
# Final optimized version with robust and clean chain proxy logic.

# DNS Configuration
dns:
  enable: true
  listen: 0.0.0.0:1053
  prefer-h3: false
  respect-rules: true
  use-system-hosts: false
  cache-algorithm: arc
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - '+.lan'
    - '+.local'
    - '+.msftconnecttest.com'
    - '+.msftncsi.com'
    - 'localhost.ptlogin2.qq.com'
    - 'localhost.sec.qq.com'
    - 'localhost.work.weixin.qq.com'
  default-nameserver: [223.5.5.5, 1.2.4.8]
  nameserver:
    - "https://cloudflare-dns.com/dns-query"
    - "https://doh.pub/dns-query"
  proxy-server-nameserver: ["https://doh.pub/dns-query"]
  direct-nameserver: ["https://doh.pub/dns-query"]
  direct-nameserver-follow-policy: false
  nameserver-policy:
    'geosite:cn': ["https://doh.pub/dns-query", "https://223.5.5.5/dns-query"]

# Proxies - Landing nodes are defined here but are NOT for direct use.
proxies:
  - name: "🇺🇸 Alice落地"
    server: "91.103.121.216"
    port: 1080
    type: socks5
    username: "wangbaoqiang"
    password: "wangdabao5424"
    udp: true
  - name: "🇯🇵 ACCK日本落地"
    server: "154.82.137.234"
    port: 20742
    type: ss
    cipher: "chacha20-ietf-poly1305"
    password: "123456"
    udp: true

# Proxy Providers - Your entry point subscriptions.
proxy-providers:
  "流量光":
    type: http
    url: "https://rgergergergerg6555.saojc.xyz/api/v1/client/subscribe?token=44e06d7500a929e0ea0e21f4d09d0273"
    interval: 86400
    health-check: { enable: true, url: "https://www.google.com/generate_204", interval: 300 }
    override: { additional-prefix: "流量光 |" }
  "green":
    type: http
    url: "http://green.592527.xyz:2096/wangbaoqiang/7ruf35lzrntxcu25"
    interval: 86400
    health-check: { enable: true, url: "https://www.google.com/generate_204", interval: 300 }
    override: { additional-prefix: "green |" }
  "ouo":
    type: http
    url: "https://push.cauenvao.click/api/v1/client/subscribe?token=1a6d8263800c15ecb2c53acc163dc5fb"
    interval: 86400
    health-check: { enable: true, url: "https://www.google.com/generate_204", interval: 300 }
    override: { additional-prefix: "ouo |" }

# Rule Providers (Shortened for brevity, no changes needed)
rule-providers:
  reject: { type: http, format: yaml, interval: 86400, behavior: domain, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/reject.txt", path: "./ruleset/loyalsoldier/reject.yaml" }
  icloud: { type: http, format: yaml, interval: 86400, behavior: domain, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/icloud.txt", path: "./ruleset/loyalsoldier/icloud.yaml" }
  apple: { type: http, format: yaml, interval: 86400, behavior: domain, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/apple.txt", path: "./ruleset/loyalsoldier/apple.yaml" }
  google: { type: http, format: yaml, interval: 86400, behavior: domain, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/google.txt", path: "./ruleset/loyalsoldier/google.yaml" }
  proxy: { type: http, format: yaml, interval: 86400, behavior: domain, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/proxy.txt", path: "./ruleset/loyalsoldier/proxy.yaml" }
  direct: { type: http, format: yaml, interval: 86400, behavior: domain, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/direct.txt", path: "./ruleset/loyalsoldier/direct.yaml" }
  private: { type: http, format: yaml, interval: 86400, behavior: domain, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/private.txt", path: "./ruleset/loyalsoldier/private.yaml" }
  gfw: { type: http, format: yaml, interval: 86400, behavior: domain, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/gfw.txt", path: "./ruleset/loyalsoldier/gfw.yaml" }
  "tld-not-cn": { type: http, format: yaml, interval: 86400, behavior: domain, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/tld-not-cn.txt", path: "./ruleset/loyalsoldier/tld-not-cn.yaml" }
  telegramcidr: { type: http, format: yaml, interval: 86400, behavior: ipcidr, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/telegramcidr.txt", path: "./ruleset/loyalsoldier/telegramcidr.yaml" }
  cncidr: { type: http, format: yaml, interval: 86400, behavior: ipcidr, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/cncidr.txt", path: "./ruleset/loyalsoldier/cncidr.yaml" }
  lancidr: { type: http, format: yaml, interval: 86400, behavior: ipcidr, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/lancidr.txt", path: "./ruleset/loyalsoldier/lancidr.yaml" }
  applications: { type: http, format: yaml, interval: 86400, behavior: classical, url: "https://fastly.jsdelivr.net/gh/Loyalsoldier/clash-rules@release/applications.txt", path: "./ruleset/loyalsoldier/applications.yaml" }
  openai: { type: http, format: yaml, interval: 86400, behavior: classical, url: "https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/meta/geo/geosite/classical/openai.yaml", path: "./ruleset/MetaCubeX/openai.yaml" }

# Proxy Groups
proxy-groups:
  - name: "🔰 模式选择"
    type: select
    proxies:
      - "⚙️ 节点选择"   # For general use
      - "🔗 链式代理"   # For unlocking specific services
      - "🔗 全局直连"
      - "🥰 广告过滤"

  - name: "⚙️ 节点选择"
    type: select
    proxies:
      - "♻️ 自动选择"
      - "🚑 故障转移"
    use: ["流量光", "green", "ouo"]
    icon: "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/adjust.svg"

  - name: "🔗 链式代理"
    type: select
    icon: "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/chains.svg"
    proxies:
      - "🇺🇸 美国解锁"
      - "🇯🇵 日本解锁"
      # You can create more chains by copying the structure below

  # --- Chain Builder Groups (The core logic) ---
  - name: "🇺🇸 美国解锁"
    type: url-test
    use: ["流量光", "green", "ouo"]
    dialer-proxy: "🇺🇸 Alice落地" # Exit through US node
    url: "https://www.google.com/generate_204"
    interval: 3600
  - name: "🇯🇵 日本解锁"
    type: url-test
    use: ["流量光", "green", "ouo"]
    dialer-proxy: "🇯🇵 ACCK日本落地" # Exit through JP node
    url: "https://www.google.com/generate_204"
    interval: 3600
    
  # --- Standard Groups ---
  - name: "♻️ 自动选择"
    type: url-test
    use: ["流量光", "green", "ouo"]
    icon: "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/speed.svg"
    url: "https://www.google.com/generate_204"
    interval: 300

  - name: "🚑 故障转移"
    type: fallback
    use: ["流量光", "green", "ouo"]
    icon: "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/ambulance.svg"
    url: "https://www.google.com/generate_204"
    interval: 300

  # --- Policy Groups for Rules ---
  - name: "💸 AI服务"
    type: select
    proxies:
      - "🔗 链式代理" # Prioritize chains for unlocking
      - "⚙️ 节点选择"
      - "🔗 全局直连"
    icon: "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/chatgpt.svg"
  
  - name: "🎬 流媒体"
    type: select
    proxies:
      - "🔗 链式代理" # Prioritize chains for unlocking
      - "⚙️ 节点选择"
      - "🔗 全局直连"
    icon: "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/youtube.svg"

  - name: "📲 电报消息"
    type: select
    proxies: ["⚙️ 节点选择", "🔗 全局直连"]
    icon: "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/telegram.svg"

  - name: "🍎 苹果服务"
    type: select
    proxies: ["🔗 全局直连", "⚙️ 节点选择"]
    icon: "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/apple.svg"

  - name: "🥰 广告过滤"
    type: select
    proxies: ["REJECT", "DIRECT"]
    icon: "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/bug.svg"
  
  - name: "🔗 全局直连"
    type: select
    proxies: ["DIRECT"]

  - name: "🐟 漏网之鱼"
    type: select
    proxies: ["🔰 模式选择", "🔗 全局直连"]
    icon: "https://fastly.jsdelivr.net/gh/clash-verge-rev/clash-verge-rev.github.io@main/docs/assets/icons/fish.svg"


# Rules - Pointing services to the right policy groups
rules:
  # Unlock specific services using chains
  - DOMAIN-SUFFIX,netflix.com,🎬 流媒体
  - DOMAIN-KEYWORD,hbo,🎬 流媒体
  - DOMAIN-SUFFIX,disneyplus.com,🎬 流媒体
  
  # AI Services
  - RULE-SET,openai,💸 AI服务
  
  # Other rules
  - RULE-SET,applications,🔗 全局直连
  - RULE-SET,private,🔗 全局直连
  - RULE-SET,reject,🥰 广告过滤
  - RULE-SET,icloud,🍎 苹果服务
  - RULE-SET,apple,🍎 苹果服务
  - RULE-SET,google,⚙️ 节点选择
  - RULE-SET,proxy,⚙️ 节点选择
  - RULE-SET,gfw,⚙️ 节点选择
  - RULE-SET,tld-not-cn,⚙️ 节点选择
  - RULE-SET,direct,🔗 全局直连
  - RULE-SET,lancidr,🔗 全局直连,no-resolve
  - RULE-SET,cncidr,🔗 全局直连,no-resolve
  - RULE-SET,telegramcidr,📲 电报消息,no-resolve
  - GEOIP,LAN,🔗 全局直连,no-resolve
  - GEOIP,CN,🔗 全局直连,no-resolve
  - MATCH,🐟 漏网之鱼

